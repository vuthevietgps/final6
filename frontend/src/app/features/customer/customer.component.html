<div class="customer-container">
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <h1>ğŸ‘¥ Quáº£n LÃ½ KhÃ¡ch HÃ ng</h1>
      <p>Quáº£n lÃ½ thÃ´ng tin khÃ¡ch hÃ ng vÃ  thá»i háº¡n sá»­ dá»¥ng sáº£n pháº©m</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="syncFromOrders()" [disabled]="isLoading()">
        <span class="icon">ğŸ”„</span>
        {{ isLoading() ? 'Äang Ä‘á»“ng bá»™...' : 'Äá»“ng Bá»™ Dá»¯ Liá»‡u' }}
      </button>
      <button class="btn btn-primary" (click)="updateRemainingDays()" [disabled]="isLoading()">
        <span class="icon">ğŸ“Š</span>
        Cáº­p Nháº­t Thá»i Gian
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">ğŸ‘¥</div>
      <div class="stat-content">
        <div class="stat-number">{{ stats().totalCustomers }}</div>
        <div class="stat-label">Tá»•ng KhÃ¡ch HÃ ng</div>
      </div>
    </div>
    <div class="stat-card active">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <div class="stat-number">{{ stats().activeCustomers }}</div>
        <div class="stat-label">Äang Hoáº¡t Äá»™ng</div>
      </div>
    </div>
    <div class="stat-card warning">
      <div class="stat-icon">âš ï¸</div>
      <div class="stat-content">
        <div class="stat-number">{{ stats().expiringSoon }}</div>
        <div class="stat-label">Sáº¯p Háº¿t Háº¡n</div>
      </div>
    </div>
    <div class="stat-card danger">
      <div class="stat-icon">âŒ</div>
      <div class="stat-content">
        <div class="stat-number">{{ stats().expired }}</div>
        <div class="stat-label">ÄÃ£ Háº¿t Háº¡n</div>
      </div>
    </div>
    <div class="stat-card disabled">
      <div class="stat-icon">ğŸš«</div>
      <div class="stat-content">
        <div class="stat-number">{{ stats().disabledCustomers }}</div>
        <div class="stat-label">ÄÃ£ VÃ´ Hiá»‡u HÃ³a</div>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error()" class="error-banner" (click)="clearError()">
    <span class="error-icon">âš ï¸</span>
    <span class="error-text">{{ error() }}</span>
    <span class="error-close">âœ•</span>
  </div>

  <!-- Search and Filters -->
  <div class="filters">
    <div class="filter-group">
      <input
        type="text"
        placeholder="ğŸ” TÃ¬m theo tÃªn hoáº·c sá»‘ Ä‘iá»‡n thoáº¡i..."
        class="search-input"
        [value]="searchTerm()"
        (input)="onSearchChange($event)"
      />
    </div>
    <div class="filter-group">
      <select
        class="filter-select"
        [value]="selectedFilter()"
        (change)="onFilterChange($event)"
      >
        <option value="all">Táº¥t cáº£ khÃ¡ch hÃ ng</option>
        <option value="active">Äang hoáº¡t Ä‘á»™ng</option>
        <option value="expiring">Sáº¯p háº¿t háº¡n (< 15 ngÃ y)</option>
        <option value="expired">ÄÃ£ háº¿t háº¡n</option>
        <option value="disabled">ÄÃ£ vÃ´ hiá»‡u hÃ³a</option>
      </select>
    </div>
  </div>

  <!-- Customers Table -->
  <div class="table-container">
    <div *ngIf="isLoading()" class="loading">
      <div class="spinner"></div>
      <p>Äang táº£i dá»¯ liá»‡u...</p>
    </div>

    <table *ngIf="!isLoading()" class="customers-table">
      <thead>
        <tr>
          <th>TÃªn KhÃ¡ch HÃ ng</th>
          <th>Sá»‘ Äiá»‡n Thoáº¡i</th>
          <th>Äá»‹a Chá»‰</th>
          <th>Sáº£n Pháº©m</th>
          <th>NgÃ y Mua Gáº§n Nháº¥t</th>
          <th>Thá»i Háº¡n S.Dá»¥ng</th>
          <th>Thá»i Gian CÃ²n Láº¡i</th>
          <th>Tráº¡ng ThÃ¡i</th>
          <th>HÃ nh Äá»™ng</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let customer of customers()" class="customer-row" 
            [class.expiring]="customer.remainingDays < 15 && customer.remainingDays > 0"
            [class.expired]="customer.remainingDays <= 0"
            [class.disabled]="customer.isDisabled">
          <td class="name-cell">
            <div class="customer-name">{{ customer.customerName }}</div>
            <div *ngIf="customer.notes" class="customer-notes">{{ customer.notes }}</div>
          </td>
          <td class="phone-cell">
            <div class="phone-number">{{ customer.phoneNumber }}</div>
          </td>
          <td class="address-cell">
            <div class="address" [title]="customer.address">{{ customer.address }}</div>
          </td>
          <td class="product-cell">
            <div class="product-info" [style.background-color]="customer.productId.color + '20'">
              <div class="product-name">{{ customer.productId.name }}</div>
              <div class="product-sku">{{ customer.productId.sku }}</div>
            </div>
          </td>
          <td class="purchase-date-cell">
            <div class="purchase-date">{{ formatDate(customer.latestPurchaseDate) }}</div>
          </td>
          <td class="duration-cell">
            <div class="duration">
              <span class="duration-value">{{ customer.usageDurationMonths }}</span>
              <span class="duration-unit">thÃ¡ng</span>
            </div>
          </td>
          <td class="remaining-cell">
            <div class="remaining-days" [class]="getRemainingDaysClass(customer.remainingDays)">
              <span class="days-value">{{ customer.remainingDays }}</span>
              <span class="days-unit">ngÃ y</span>
            </div>
          </td>
          <td class="status-cell">
            <span class="status-badge" [class]="getStatusClass(customer)">
              {{ getStatusText(customer) }}
            </span>
          </td>
          <td class="actions-cell">
            <button 
              *ngIf="!customer.isDisabled" 
              class="btn-icon btn-disable" 
              (click)="disableCustomer(customer)" 
              title="VÃ´ hiá»‡u hÃ³a">
              ğŸš«
            </button>
            <button 
              *ngIf="customer.isDisabled" 
              class="btn-icon btn-enable" 
              (click)="enableCustomer(customer)" 
              title="KÃ­ch hoáº¡t láº¡i">
              âœ…
            </button>
            <button class="btn-icon btn-edit" (click)="openEditModal(customer)" title="Chá»‰nh sá»­a">
              âœï¸
            </button>
            <button class="btn-icon btn-delete" (click)="deleteCustomer(customer)" title="XÃ³a">
              ğŸ—‘ï¸
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!isLoading() && customers().length === 0" class="empty-state">
      <div class="empty-icon">ğŸ‘¥</div>
      <h3>KhÃ´ng cÃ³ khÃ¡ch hÃ ng nÃ o</h3>
      <p>HÃ£y Ä‘á»“ng bá»™ dá»¯ liá»‡u tá»« Ä‘Æ¡n hÃ ng hoáº·c Ä‘iá»u chá»‰nh bá»™ lá»c tÃ¬m kiáº¿m</p>
      <button class="btn btn-primary" (click)="syncFromOrders()">
        <span class="icon">ğŸ”„</span>
        Äá»“ng Bá»™ Dá»¯ Liá»‡u
      </button>
    </div>
  </div>
</div>

<!-- Edit Customer Modal -->
<div *ngIf="isEditModalOpen()" class="modal-overlay" (click)="closeEditModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>âœï¸ Chá»‰nh Sá»­a KhÃ¡ch HÃ ng</h2>
      <button class="modal-close" (click)="closeEditModal()">âœ•</button>
    </div>

    <form class="modal-form" (ngSubmit)="updateCustomer()">
      <div class="form-grid">
        <div class="form-group">
          <label for="edit-customerName">TÃªn KhÃ¡ch HÃ ng *</label>
          <input
            type="text"
            id="edit-customerName"
            required
            [value]="formData().customerName"
            (input)="onInputChange('customerName', $event)"
            placeholder="Nháº­p tÃªn khÃ¡ch hÃ ng"
          />
        </div>

        <div class="form-group">
          <label for="edit-phoneNumber">Sá»‘ Äiá»‡n Thoáº¡i *</label>
          <input
            type="tel"
            id="edit-phoneNumber"
            required
            [value]="formData().phoneNumber"
            (input)="onInputChange('phoneNumber', $event)"
            placeholder="Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i"
          />
        </div>

        <div class="form-group full-width">
          <label for="edit-address">Äá»‹a Chá»‰ *</label>
          <textarea
            id="edit-address"
            required
            rows="3"
            [value]="formData().address"
            (input)="onInputChange('address', $event)"
            placeholder="Nháº­p Ä‘á»‹a chá»‰ khÃ¡ch hÃ ng"
          ></textarea>
        </div>

        <div class="form-group full-width">
          <label for="edit-notes">Ghi ChÃº</label>
          <textarea
            id="edit-notes"
            rows="3"
            [value]="formData().notes"
            (input)="onInputChange('notes', $event)"
            placeholder="Ghi chÃº vá» khÃ¡ch hÃ ng..."
          ></textarea>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeEditModal()">
          Há»§y
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="isLoading()">
          <span *ngIf="isLoading()" class="spinner small"></span>
          {{ isLoading() ? 'Äang cáº­p nháº­t...' : 'Cáº­p Nháº­t' }}
        </button>
      </div>
    </form>
  </div>
</div>