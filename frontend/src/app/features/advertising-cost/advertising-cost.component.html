<div class="container">
  <h2>üì¢ Chi Ph√≠ Qu·∫£ng C√°o</h2>

  <div class="toolbar">
  <button (click)="addNew()">+ Th√™m m·ªõi</button>
    <select [value]="filterAdAccountId()" (change)="filterAdAccountId.set($any($event.target).value); onFilterChange()">
      <option value="all">T·∫•t c·∫£ TK QC</option>
      <option *ngFor="let a of adAccounts()" [value]="a._id">{{ a.name }} ({{ a.accountId }})</option>
    </select>
    <div class="summary" *ngIf="summary() as s">
      <span>T·ªïng chi: {{ s.totalSpent | number:'1.0-0' }}</span>
      <span>S·ªë b·∫£n ghi: {{ s.count }}</span>
      <span>Avg CPM: {{ s.avgCPM | number:'1.0-2' }}</span>
      <span>Avg CPC: {{ s.avgCPC | number:'1.0-2' }}</span>
    </div>
  </div>

  <div *ngIf="error()" class="error">{{ error() }}</div>

  <table class="list">
    <thead>
      <tr>
        <th>Ng√†y (MM/DD/YYYY)</th>
        <th>T·∫ßn su·∫•t</th>
        <th>ID Nh√≥m QC</th>
        <th>T√†i kho·∫£n QC</th>
        <th>ƒê√£ chi</th>
        <th>CPM</th>
        <th>CPC</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let r of items()">
        <td>{{ r.date }}</td>
        <td>{{ r.frequency || '-' }}</td>
        <td>{{ r.adGroupId }}</td>
        <td>{{ r.adAccountName ? (r.adAccountName + ' (' + r.adAccountAccountId + ')') : '-' }}</td>
        <td>{{ r.spentAmount || 0 }}</td>
        <td>{{ r.cpm || 0 }}</td>
        <td>{{ r.cpc || 0 }}</td>
        <td>
          <button (click)="openEdit(r)">S·ª≠a</button>
          <button (click)="remove(r._id!)">X√≥a</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Modal (kh√¥ng d√πng khi t·∫°o nhanh) -->
  <div class="modal" *ngIf="false && showModal()">
    <div class="modal-content">
      <h3>{{ editingId ? 'C·∫≠p nh·∫≠t' : 'Th√™m m·ªõi' }} Chi Ph√≠ Qu·∫£ng C√°o</h3>
      <form [formGroup]="form" (ngSubmit)="save()">
        <div class="form-row">
          <label>Ng√†y (MM/DD/YYYY)</label>
     <input type="text" placeholder="MM/DD/YYYY"
       [value]="getDateInputValue()"
       (input)="form.patchValue({ date: $any($event.target).value })" />
        </div>
        <div class="form-row">
          <label>T·∫ßn su·∫•t</label>
          <input type="number" formControlName="frequency" />
        </div>
        <div class="form-row">
          <label>ID Nh√≥m qu·∫£ng c√°o</label>
          <input type="text" formControlName="adGroupId" required />
        </div>
        <div class="form-row">
          <label>ƒê√£ chi</label>
          <input type="number" formControlName="spentAmount" />
        </div>
        <div class="form-row">
          <label>CPM</label>
          <input type="number" formControlName="cpm" />
        </div>
        <div class="form-row">
          <label>CPC</label>
          <input type="number" formControlName="cpc" />
        </div>
        <div class="actions">
          <button type="submit" [disabled]="form.invalid">L∆∞u</button>
          <button type="button" (click)="closeModal()">ƒê√≥ng</button>
        </div>
      </form>
    </div>
  </div>
</div>
