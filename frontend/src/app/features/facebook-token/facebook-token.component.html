<!-- facebook-token.component.html -->
<div class="facebook-token-container">
  <div class="header">
    <h2>ğŸ” Quáº£n LÃ½ Facebook Access Tokens</h2>
    <p class="description">
      LÆ°u vÃ  quáº£n lÃ½ Facebook Access Tokens Ä‘á»ƒ tá»± Ä‘á»™ng Ä‘á»“ng bá»™ chi phÃ­ quáº£ng cÃ¡o
    </p>
  </div>

  <!-- Actions -->
  <div class="actions">
    <button
      class="btn btn-primary"
      (click)="openCreate()"
      [disabled]="loading()"
    >
      â• ThÃªm Token Má»›i
    </button>

    <div class="status-info">
      <span class="status-badge" [class.success]="hasDefaultToken" [class.warning]="!hasDefaultToken">
        {{ hasDefaultToken ? 'âœ… CÃ³ token máº·c Ä‘á»‹nh' : 'âš ï¸ ChÆ°a cÃ³ token máº·c Ä‘á»‹nh' }}
      </span>
    </div>
  </div>

  <!-- Error Message -->
  <div class="alert alert-error" *ngIf="error()">
    <strong>âŒ Lá»—i:</strong> {{ error() }}
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="loading()">
    <div class="spinner"></div>
    <span>Äang táº£i...</span>
  </div>

  <!-- Tokens List -->
  <div class="tokens-grid" *ngIf="!loading()">
    <div 
      *ngFor="let token of tokens()" 
      class="token-card"
      [class.default]="token.isDefault"
      [class.inactive]="!token.isActive"
    >
      <div class="token-header">
        <h3>{{ token.name }}</h3>
        <div class="token-badges">
          <span class="badge default" *ngIf="token.isDefault">Máº·c Ä‘á»‹nh</span>
          <span class="badge type">{{ token.tokenType }}</span>
          <span class="badge inactive" *ngIf="!token.isActive">KhÃ´ng hoáº¡t Ä‘á»™ng</span>
        </div>
      </div>

      <div class="token-info">
        <div class="info-row">
          <strong>App ID:</strong> {{ token.appId || 'N/A' }}
        </div>
        <div class="info-row">
          <strong>Permissions:</strong> {{ formatPermissions(token.permissions) }}
        </div>
        <div class="info-row">
          <strong>Expires:</strong> {{ formatDate(token.expiresAt) }}
        </div>
        <div class="info-row">
          <strong>Usage:</strong> {{ token.usageCount }} láº§n
        </div>
        <div class="info-row">
          <strong>Last Used:</strong> {{ formatDate(token.lastUsedAt) }}
        </div>
        <div class="info-row" *ngIf="token.notes">
          <strong>Notes:</strong> {{ token.notes }}
        </div>
      </div>

      <div class="token-actions">
        <button
          class="btn btn-sm btn-success"
          (click)="testToken(token._id!)"
          [disabled]="loading() || !token.isActive"
          title="Test token"
        >
          ğŸ” Test
        </button>

        <button
          class="btn btn-sm btn-primary"
          (click)="setDefault(token._id!)"
          [disabled]="loading() || token.isDefault || !token.isActive"
          title="Set as default"
        >
          â­ Set Default
        </button>

        <button
          class="btn btn-sm btn-secondary"
          (click)="openEdit(token)"
          [disabled]="loading()"
          title="Edit token"
        >
          âœï¸ Edit
        </button>

        <button
          class="btn btn-sm btn-danger"
          (click)="delete(token._id!)"
          [disabled]="loading()"
          title="Delete token"
        >
          ğŸ—‘ï¸ Delete
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="tokens().length === 0">
      <div class="empty-icon">ğŸ”</div>
      <h3>ChÆ°a cÃ³ Facebook Token nÃ o</h3>
      <p>ThÃªm token Ä‘áº§u tiÃªn Ä‘á»ƒ báº¯t Ä‘áº§u Ä‘á»“ng bá»™ tá»± Ä‘á»™ng</p>
      <button class="btn btn-primary" (click)="openCreate()">
        â• ThÃªm Token Äáº§u TiÃªn
      </button>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" *ngIf="showModal()" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ editingId ? 'Chá»‰nh Sá»­a' : 'ThÃªm Má»›i' }} Facebook Token</h3>
        <button class="close-btn" (click)="closeModal()">âœ•</button>
      </div>

      <form [formGroup]="form" (ngSubmit)="save()">
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label for="name">TÃªn Token *</label>
              <input
                type="text"
                id="name"
                formControlName="name"
                placeholder="VD: Production Token, Test Token..."
                class="form-control"
                [class.error]="form.get('name')?.invalid && form.get('name')?.touched"
              />
            </div>

            <div class="form-group">
              <label for="tokenType">Loáº¡i Token</label>
              <select id="tokenType" formControlName="tokenType" class="form-control">
                <option value="user">User Token</option>
                <option value="page">Page Token</option>
                <option value="app">App Token</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="accessToken">Access Token *</label>
            <textarea
              id="accessToken"
              formControlName="accessToken"
              placeholder="Nháº­p Facebook Access Token..."
              class="form-control"
              rows="3"
              [class.error]="form.get('accessToken')?.invalid && form.get('accessToken')?.touched"
            ></textarea>
            <small class="help-text" *ngIf="editingId">
              Äá»ƒ trá»‘ng náº¿u khÃ´ng muá»‘n thay Ä‘á»•i token hiá»‡n táº¡i
            </small>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="appId">App ID</label>
              <input
                type="text"
                id="appId"
                formControlName="appId"
                placeholder="Facebook App ID..."
                class="form-control"
              />
            </div>

            <div class="form-group">
              <label for="userId">User ID</label>
              <input
                type="text"
                id="userId"
                formControlName="userId"
                placeholder="Facebook User ID..."
                class="form-control"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="expiresAt">NgÃ y Háº¿t Háº¡n</label>
              <input
                type="date"
                id="expiresAt"
                formControlName="expiresAt"
                class="form-control"
              />
            </div>

            <div class="form-group">
              <label for="permissions">Permissions</label>
              <input
                type="text"
                id="permissions"
                formControlName="permissions"
                placeholder="ads_read, ads_management..."
                class="form-control"
              />
              <small class="help-text">CÃ¡ch nhau báº±ng dáº¥u pháº©y</small>
            </div>
          </div>

          <div class="form-group">
            <label for="notes">Ghi ChÃº</label>
            <textarea
              id="notes"
              formControlName="notes"
              placeholder="Ghi chÃº vá» token nÃ y..."
              class="form-control"
              rows="2"
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group checkbox-group">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  formControlName="isActive"
                />
                <span>Token Ä‘ang hoáº¡t Ä‘á»™ng</span>
              </label>
            </div>

            <div class="form-group checkbox-group">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  formControlName="isDefault"
                />
                <span>Äáº·t lÃ m token máº·c Ä‘á»‹nh</span>
              </label>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-outline"
            (click)="closeModal()"
            [disabled]="loading()"
          >
            Há»§y
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="form.invalid || loading()"
          >
            <span *ngIf="loading()">â³ Äang lÆ°u...</span>
            <span *ngIf="!loading()">ğŸ’¾ {{ editingId ? 'Cáº­p nháº­t' : 'Táº¡o má»›i' }}</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>