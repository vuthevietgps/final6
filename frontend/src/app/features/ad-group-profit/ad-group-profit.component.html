<!-- 
File: features/ad-group-profit/ad-group-profit.component.html
Mục đích: Template hiển thị báo cáo lợi nhuận theo nhóm quảng cáo theo ngày
-->
<div class="ad-group-profit-container">
  <!-- Header -->
  <div class="header">
    <h2>📊 Lợi nhuận và chi phí quảng cáo</h2>
  <p class="subtitle">Theo ngày: Lợi nhuận và Chi phí QC (từ Summary5)</p>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card profit">
      <div class="stat-icon">💰</div>
      <div class="stat-info">
        <div class="stat-label">Tổng Lợi Nhuận</div>
        <div class="stat-value">{{ formatCurrency(stats().totalProfit) }}</div>
      </div>
    </div>
    
    <div class="stat-card orders">
      <div class="stat-icon">📦</div>
      <div class="stat-info">
        <div class="stat-label">Tổng Đơn Hàng</div>
        <div class="stat-value">{{ formatNumber(stats().totalOrders) }}</div>
      </div>
    </div>
    
    <div class="stat-card groups">
      <div class="stat-icon">📢</div>
      <div class="stat-info">
        <div class="stat-label">Nhóm Quảng Cáo</div>
        <div class="stat-value">{{ formatNumber(stats().totalAdGroups) }}</div>
      </div>
    </div>
    
    <div class="stat-card average">
      <div class="stat-icon">📊</div>
      <div class="stat-info">
        <div class="stat-label">Lợi Nhuận TB/Đơn</div>
        <div class="stat-value">{{ formatCurrency(stats().avgProfitPerOrder) }}</div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filters-row">
      <div class="filter-group">
        <label for="fromDate">Từ ngày:</label>
        <input 
          type="date" 
          id="fromDate"
          [(ngModel)]="filters.from"
          class="form-control"
        >
      </div>
      
      <div class="filter-group">
        <label for="toDate">Đến ngày:</label>
        <input 
          type="date" 
          id="toDate"
          [(ngModel)]="filters.to"
          class="form-control"
        >
      </div>
      
      <div class="filter-group">
        <label for="agentId">Agent ID:</label>
        <input 
          type="text" 
          id="agentId"
          [(ngModel)]="filters.agentId"
          placeholder="Để trống để xem tất cả"
          class="form-control"
        >
      </div>
      
      <div class="filter-actions">
        <button 
          (click)="applyFilters()" 
          class="btn btn-primary"
          [disabled]="loading()"
        >
          <span *ngIf="loading()">⏳</span>
          <span *ngIf="!loading()">🔍</span>
          Tìm kiếm
        </button>
        
        <button 
          (click)="resetFilters()" 
          class="btn btn-secondary"
          [disabled]="loading()"
        >
          🔄 Reset
        </button>
        
        <button 
          (click)="exportToCSV()" 
          class="btn btn-success"
          [disabled]="loading() || reports().length === 0"
        >
          📁 Xuất CSV
        </button>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error()" class="error-message">
    ⚠️ {{ error() }}
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="loading()" class="loading-indicator">
    <div class="spinner"></div>
    <span>Đang tải dữ liệu...</span>
  </div>

  <!-- Data Table -->
  <div *ngIf="!loading() && !error()" class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>Ngày Tháng</th>
          <th>Nhóm Quảng Cáo</th>
          <th>Chi Phí QC (QC2)</th>
          <th>Lợi Nhuận (Summary2)</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let report of reports(); trackBy: trackByDate" class="data-row">
          <td class="date-cell">{{ formatDate(report.date) }}</td>
          <td class="ad-group-cell">{{ report.adGroupName }} {{ '{' }}{{ report.adGroupId }}{{ '}' }}</td>
          <td class="currency-cell">{{ formatCurrency(report.adsCost || 0) }}</td>
          <td class="profit-cell" [ngClass]="getProfitColorClass(report.totalProfit)">
            {{ formatCurrency(report.totalProfit) }}
          </td>
        </tr>
        
        <!-- No Data Message -->
        <tr *ngIf="reports().length === 0" class="no-data-row">
          <td colspan="4" class="no-data-cell">
            📭 Không có dữ liệu trong khoảng thời gian được chọn
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
