<!--
  File: advertising-cost-suggestion.component.html
  M·ª•c ƒë√≠ch: Template HTML cho component ƒë·ªÅ xu·∫•t chi ph√≠ qu·∫£ng c√°o
  Bao g·ªìm: Form th√™m/s·ª≠a, b·∫£ng d·ªØ li·ªáu, th·ªëng k√™
-->
<div class="advertising-cost-suggestion-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <h2 class="page-title">üí∞ ƒê·ªÅ Xu·∫•t Chi Ph√≠ Qu·∫£ng C√°o</h2>
      <div class="header-actions">
        <button 
          class="btn btn-sync"
          (click)="syncDailyCosts()"
          [disabled]="loading()"
          title="ƒê·ªìng b·ªô chi ph√≠ t·ª´ Chi Ph√≠ Qu·∫£ng C√°o 2">
          üîÑ ƒê·ªìng B·ªô
        </button>
        <button 
          class="btn btn-test"
          (click)="loadData()"
          [disabled]="loading()"
          title="Test load d·ªØ li·ªáu">
          üîç Test Load
        </button>
        <span class="help-text">
          üí° Nh·∫≠p chi ph√≠ ƒë·ªÅ xu·∫•t tr·ª±c ti·∫øp v√†o b·∫£ng b√™n d∆∞·ªõi
        </span>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading()" class="loading">
    <div class="spinner"></div>
    <span>ƒêang t·∫£i d·ªØ li·ªáu...</span>
  </div>

  <!-- Error -->
  <div *ngIf="error()" class="alert alert-danger">
    <strong>‚ùå L·ªói:</strong> {{ error() }}
    <button class="btn-close" (click)="error.set(null)">√ó</button>
  </div>

  <!-- Statistics -->
  <div *ngIf="statistics()" class="statistics-grid">
    <div class="stat-card">
      <div class="stat-value">{{ combinedDataComputed().length }}</div>
      <div class="stat-label">T·ªïng Nh√≥m Qu·∫£ng C√°o</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ totalSuggestions() }}</div>
      <div class="stat-label">ƒê√£ C√≥ ƒê·ªÅ Xu·∫•t</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ formatCurrency(statistics()!.totalSuggestedCost) }}</div>
      <div class="stat-label">T·ªïng Chi Ph√≠ ƒê·ªÅ Xu·∫•t</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ formatCurrency(statistics()!.totalDailyCost) }}</div>
      <div class="stat-label">T·ªïng Chi Ph√≠ H√¥m Qua</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" [class]="getDifferenceColorClass(statistics()!.totalDifference)">
        {{ formatCurrency(statistics()!.totalDifference) }}
      </div>
      <div class="stat-label">T·ªïng Ch√™nh L·ªách</div>
    </div>
  </div>

  <!-- Add/Edit Form - ·∫®n v√¨ kh√¥ng c·∫ßn thi·∫øt -->
  <div *ngIf="false" class="form-container" style="display: none;">
    <div class="form-header">
      <h3>{{ editingId() ? '‚úèÔ∏è Ch·ªânh S·ª≠a ƒê·ªÅ Xu·∫•t' : '‚ûï Th√™m ƒê·ªÅ Xu·∫•t M·ªõi' }}</h3>
      <button class="btn btn-close" (click)="hideForm()">√ó</button>
    </div>
    
    <form (ngSubmit)="onSubmit()" class="suggestion-form">
      <div class="form-grid">
        <div class="form-group">
          <label for="adGroupId">Nh√≥m Qu·∫£ng C√°o *</label>
          <select 
            id="adGroupId"
            [(ngModel)]="formData().adGroupId"
            name="adGroupId"
            class="form-control"
            (change)="onAdGroupSelected(formData().adGroupId)"
            required>
            <option value="">-- Ch·ªçn Nh√≥m Qu·∫£ng C√°o --</option>
            <option 
              *ngFor="let adGroup of adGroups()" 
              [value]="adGroup._id">
              {{ adGroup.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="suggestedCost">Chi Ph√≠ ƒê·ªÅ Xu·∫•t (VNƒê) *</label>
          <input 
            type="number"
            id="suggestedCost"
            [(ngModel)]="formData().suggestedCost"
            name="suggestedCost"
            class="form-control"
            min="0"
            step="1000"
            required>
        </div>

        <div class="form-group">
          <label for="dailyCost">Chi Ph√≠ H√†ng Ng√†y (VNƒê)</label>
          <input 
            type="number"
            id="dailyCost"
            [value]="formData().dailyCost"
            class="form-control"
            readonly
            title="T·ª± ƒë·ªông l·∫•y t·ª´ Advertising Cost 2">
        </div>

        <div class="form-group">
          <label>
            <input 
              type="checkbox"
              [(ngModel)]="formData().isActive"
              name="isActive">
            ƒêang ho·∫°t ƒë·ªông
          </label>
        </div>
      </div>

      <div class="form-group full-width">
        <label for="notes">Ghi Ch√∫</label>
        <textarea 
          id="notes"
          [(ngModel)]="formData().notes"
          name="notes"
          class="form-control"
          rows="3"
          placeholder="Ghi ch√∫ v·ªÅ ƒë·ªÅ xu·∫•t chi ph√≠..."></textarea>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="hideForm()">
          H·ªßy
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="loading()">
          {{ editingId() ? 'C·∫≠p Nh·∫≠t' : 'Th√™m M·ªõi' }}
        </button>
      </div>
    </form>
  </div>

  <!-- Data Table -->
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>Nh√≥m Qu·∫£ng C√°o</th>
          <th>Chi Ph√≠ ƒê·ªÅ Xu·∫•t</th>
          <th>Chi Ph√≠ Ng√†y H√¥m Qua</th>
          <th>Ch√™nh L·ªách</th>
          <th>Ch√™nh L·ªách (%)</th>
          <th>Ghi Ch√∫</th>
          <th>Tr·∫°ng Th√°i</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="combinedDataComputed().length === 0">
          <td colspan="7" class="no-data">
            <div class="no-data-content">
              <span class="no-data-icon">üìã</span>
              <span>Ch∆∞a c√≥ nh√≥m qu·∫£ng c√°o n√†o</span>
            </div>
          </td>
        </tr>
        <tr *ngFor="let row of combinedDataComputed()" 
            [class.has-suggestion]="row.suggestionId"
            [class.no-suggestion]="!row.suggestionId">
          <td>
            <div class="ad-group-info">
              <strong>{{ row.adGroupName }}</strong>
              <small class="text-muted">ID: {{ row.adGroupId }}</small>
              <span *ngIf="!row.suggestionId" class="new-badge">M·ªõi</span>
            </div>
          </td>
          <td>
            <input 
              type="number"
              [value]="row.suggestedCost"
              class="inline-input editable"
              min="0"
              step="1000"
              (blur)="updateSuggestedCost(row, $event)"
              [placeholder]="row.suggestionId ? 'Chi ph√≠ ƒë·ªÅ xu·∫•t' : 'Nh·∫≠p chi ph√≠ ƒë·ªÅ xu·∫•t'"
              title="Click ƒë·ªÉ nh·∫≠p chi ph√≠ ƒë·ªÅ xu·∫•t">
          </td>
          <td>
            <span class="currency">{{ formatCurrency(row.dailyCost) }}</span>
          </td>
          <td>
            <span 
              class="currency"
              [class]="getDifferenceColorClass(row.dailyDifference)">
              {{ formatCurrency(row.dailyDifference) }}
            </span>
          </td>
          <td>
            <span 
              class="percentage"
              [class]="getDifferenceColorClass(row.dailyDifference)">
              {{ formatPercentage(row.dailyDifferencePercent) }}
            </span>
          </td>
          <td>
            <input 
              type="text"
              [value]="row.notes"
              class="inline-input notes-input"
              (blur)="updateNotes(row, $event)"
              placeholder="Ghi ch√∫...">
          </td>
          <td>
            <span class="status-badge" 
                  [class.active]="row.suggestionId && row.isActive"
                  [class.inactive]="!row.suggestionId">
              {{ row.suggestionId ? (row.isActive ? 'C√≥ ƒë·ªÅ xu·∫•t' : 'Kh√¥ng ho·∫°t ƒë·ªông') : 'Ch∆∞a c√≥ ƒë·ªÅ xu·∫•t' }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>