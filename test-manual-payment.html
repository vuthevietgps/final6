<!DOCTYPE html>
<html>
<head>
    <title>Test Manual Payment API</title>
</head>
<body>
    <h1>Test Manual Payment API</h1>
    
    <div>
        <label>Summary ID:</label>
        <input type="text" id="summaryId" value="68ce69737f8c10b94edac97f" style="width: 300px;">
    </div>
    
    <div>
        <label>Manual Payment:</label>
        <input type="number" id="manualPayment" value="5000">
    </div>
    
    <button onclick="testAPI()">Test API</button>
    <button onclick="getSummary()">Get Summary</button>
    
    <div id="result" style="margin-top: 20px; border: 1px solid #ccc; padding: 10px; white-space: pre-wrap;"></div>

    <script>
        function showResult(data) {
            document.getElementById('result').textContent = JSON.stringify(data, null, 2);
        }

        function testAPI() {
            const summaryId = document.getElementById('summaryId').value;
            const manualPayment = parseFloat(document.getElementById('manualPayment').value);
            
            fetch(`http://localhost:3000/google-sync/summary/${summaryId}/manual-payment`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ manualPayment })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Success:', data);
                showResult({
                    success: true,
                    data: data,
                    calculation: {
                        paid: data.paid,
                        mustPay: data.mustPay,
                        manualPayment: data.manualPayment,
                        needToPay: data.needToPay,
                        formula: `${data.paid} - ${data.mustPay} - ${data.manualPayment} = ${data.needToPay}`
                    }
                });
            })
            .catch(error => {
                console.error('Error:', error);
                showResult({ success: false, error: error.message });
            });
        }

        function getSummary() {
            const summaryId = document.getElementById('summaryId').value;
            
            fetch(`http://localhost:3000/google-sync/summary/filter?limit=1`)
            .then(response => response.json())
            .then(data => {
                showResult(data.rows[0] || {});
                if (data.rows[0]) {
                    document.getElementById('summaryId').value = data.rows[0]._id;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showResult({ error: error.message });
            });
        }
    </script>
</body>
</html>